From f893678c1d74cc999f25921c237012587661af22 Mon Sep 17 00:00:00 2001
From: Rix Tox <rixtox@users.noreply.github.com>
Date: Fri, 21 Oct 2022 07:24:29 +0000
Subject: [PATCH] tweaks

---
 src/settings_pack.cpp | 106 +++++++++++++++++++++---------------------
 1 file changed, 53 insertions(+), 53 deletions(-)

diff --git a/src/settings_pack.cpp b/src/settings_pack.cpp
index 230a92806..49137bb57 100644
--- a/src/settings_pack.cpp
+++ b/src/settings_pack.cpp
@@ -155,7 +155,7 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 	CONSTEXPR_SETTINGS
 	aux::array<bool_setting_entry_t, settings_pack::num_bool_settings> const bool_settings
 	({{
-		SET(allow_multiple_connections_per_ip, false, nullptr),
+		SET(allow_multiple_connections_per_ip, true, nullptr),
 		DEPRECATED_SET(ignore_limits_on_local_network, true, &session_impl::update_ignore_rate_limits_on_local_network),
 		SET(send_redundant_have, true, nullptr),
 		DEPRECATED_SET(lazy_bitfields, false, nullptr),
@@ -185,10 +185,10 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 		SET(no_atime_storage, true, nullptr),
 		SET(incoming_starts_queued_torrents, false, nullptr),
 		SET(report_true_downloaded, false, nullptr),
-		SET(strict_end_game_mode, true, nullptr),
+		SET(strict_end_game_mode, false, nullptr),
 		DEPRECATED_SET(broadcast_lsd, true, nullptr),
-		SET(enable_outgoing_utp, true, nullptr),
-		SET(enable_incoming_utp, true, nullptr),
+		SET(enable_outgoing_utp, false, nullptr),
+		SET(enable_incoming_utp, false, nullptr),
 		SET(enable_outgoing_tcp, true, nullptr),
 		SET(enable_incoming_tcp, true, nullptr),
 		DEPRECATED_SET(ignore_resume_timestamps, false, nullptr),
@@ -199,7 +199,7 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 		DEPRECATED_SET(announce_double_nat, false, nullptr),
 		SET(seeding_outgoing_connections, true, nullptr),
 		SET(no_connect_privileged_ports, false, &session_impl::update_privileged_ports),
-		SET(smooth_connects, true, nullptr),
+		SET(smooth_connects, false, nullptr),
 		SET(always_send_user_agent, false, nullptr),
 		SET(apply_ip_filter_to_trackers, true, nullptr),
 		DEPRECATED_SET(use_disk_read_ahead, true, nullptr),
@@ -214,10 +214,10 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 		SET(listen_system_port_fallback, true, nullptr),
 		DEPRECATED_SET(use_disk_cache_pool, false, nullptr),
 		SET(announce_crypto_support, true, nullptr),
-		SET(enable_upnp, true, &session_impl::update_upnp),
-		SET(enable_natpmp, true, &session_impl::update_natpmp),
-		SET(enable_lsd, true, &session_impl::update_lsd),
-		SET(enable_dht, true, &session_impl::update_dht),
+		SET(enable_upnp, false, &session_impl::update_upnp),
+		SET(enable_natpmp, false, &session_impl::update_natpmp),
+		SET(enable_lsd, false, &session_impl::update_lsd),
+		SET(enable_dht, false, &session_impl::update_dht),
 		SET(prefer_rc4, false, nullptr),
 		SET(proxy_hostnames, true, nullptr),
 		SET(proxy_peer_connections, true, nullptr),
@@ -248,35 +248,35 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 		SET(tracker_receive_timeout, 10, nullptr),
 		SET(stop_tracker_timeout, 5, nullptr),
 		SET(tracker_maximum_response_length, 1024*1024, nullptr),
-		SET(piece_timeout, 20, nullptr),
-		SET(request_timeout, 60, nullptr),
-		SET(request_queue_time, 3, nullptr),
-		SET(max_allowed_in_request_queue, 2000, nullptr),
-		SET(max_out_request_queue, 500, nullptr),
-		SET(whole_pieces_threshold, 20, nullptr),
+		SET(piece_timeout, 5, nullptr),
+		SET(request_timeout, 5, nullptr),
+		SET(request_queue_time, 5, nullptr),
+		SET(max_allowed_in_request_queue, 10000, nullptr),
+		SET(max_out_request_queue, 10000, nullptr),
+		SET(whole_pieces_threshold, 5, nullptr),
 		SET(peer_timeout, 120, nullptr),
 		SET(urlseed_timeout, 20, nullptr),
 		SET(urlseed_pipeline_size, 5, nullptr),
 		SET(urlseed_wait_retry, 30, nullptr),
-		SET(file_pool_size, 40, nullptr),
-		SET(max_failcount, 3, &session_impl::update_max_failcount),
-		SET(min_reconnect_time, 60, nullptr),
-		SET(peer_connect_timeout, 15, nullptr),
-		SET(connection_speed, 30, &session_impl::update_connection_speed),
-		SET(inactivity_timeout, 600, nullptr),
+		SET(file_pool_size, 5000, nullptr),
+		SET(max_failcount, 50, &session_impl::update_max_failcount),
+		SET(min_reconnect_time, 2, nullptr),
+		SET(peer_connect_timeout, 30, nullptr),
+		SET(connection_speed, 500, &session_impl::update_connection_speed),
+		SET(inactivity_timeout, 120, nullptr),
 		SET(unchoke_interval, 15, nullptr),
 		SET(optimistic_unchoke_interval, 30, nullptr),
 		SET(num_want, 200, nullptr),
-		SET(initial_picker_threshold, 4, nullptr),
-		SET(allowed_fast_set_size, 5, nullptr),
-		SET(suggest_mode, settings_pack::no_piece_suggestions, nullptr),
-		SET(max_queued_disk_bytes, 1024 * 1024, nullptr),
-		SET(handshake_timeout, 10, nullptr),
-		SET(send_buffer_low_watermark, 10 * 1024, nullptr),
-		SET(send_buffer_watermark, 500 * 1024, nullptr),
-		SET(send_buffer_watermark_factor, 50, nullptr),
+		SET(initial_picker_threshold, 10, nullptr),
+		SET(allowed_fast_set_size, 0, nullptr),
+		SET(suggest_mode, settings_pack::suggest_read_cache, nullptr),
+		SET(max_queued_disk_bytes, 10485760, nullptr),
+		SET(handshake_timeout, 30, nullptr),
+		SET(send_buffer_low_watermark, 3145728, nullptr),
+		SET(send_buffer_watermark, 10485760, nullptr),
+		SET(send_buffer_watermark_factor, 200, nullptr),
 		SET(choking_algorithm, settings_pack::fixed_slots_choker, nullptr),
-		SET(seed_choking_algorithm, settings_pack::round_robin, nullptr),
+		SET(seed_choking_algorithm, settings_pack::fastest_upload, nullptr),
 		DEPRECATED_SET(cache_size, 2048, nullptr),
 		DEPRECATED_SET(cache_buffer_chunk_size, 0, nullptr),
 		DEPRECATED_SET(cache_expiry, 300, nullptr),
@@ -284,14 +284,14 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 		SET(disk_io_read_mode, settings_pack::enable_os_cache, nullptr),
 		SET(outgoing_port, 0, nullptr),
 		SET(num_outgoing_ports, 0, nullptr),
-		SET(peer_dscp, 0x04, &session_impl::update_peer_dscp),
-		SET(active_downloads, 3, &session_impl::trigger_auto_manage),
-		SET(active_seeds, 5, &session_impl::trigger_auto_manage),
+		SET(peer_dscp, 0xB8, &session_impl::update_peer_dscp),
+		SET(active_downloads, -1, &session_impl::trigger_auto_manage),
+		SET(active_seeds, -1, &session_impl::trigger_auto_manage),
 		SET(active_checking, 1, &session_impl::trigger_auto_manage),
 		SET(active_dht_limit, 88, nullptr),
-		SET(active_tracker_limit, 1600, nullptr),
+		SET(active_tracker_limit, -1, nullptr),
 		SET(active_lsd_limit, 60, nullptr),
-		SET(active_limit, 500, &session_impl::trigger_auto_manage),
+		SET(active_limit, -1, &session_impl::trigger_auto_manage),
 		DEPRECATED_SET(active_loaded_limit, 0, &session_impl::trigger_auto_manage),
 		SET(auto_manage_interval, 30, nullptr),
 		SET(seed_time_limit, 24 * 60 * 60, nullptr),
@@ -303,15 +303,15 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 		SET(auto_manage_startup, 60, nullptr),
 		SET(seeding_piece_quota, 20, nullptr),
 		// TODO: deprecate this
-		SET(max_rejects, 50, nullptr),
+		SET(max_rejects, 100, nullptr),
 		SET(recv_socket_buffer_size, 0, &session_impl::update_socket_buffer_size),
 		SET(send_socket_buffer_size, 0, &session_impl::update_socket_buffer_size),
-		SET(max_peer_recv_buffer_size, 2 * 1024 * 1024, nullptr),
+		SET(max_peer_recv_buffer_size, 64 * 1024 * 1024, nullptr),
 		DEPRECATED_SET(file_checks_delay_per_block, 0, nullptr),
-		DEPRECATED2_SET(read_cache_line_size, 32, nullptr),
-		DEPRECATED2_SET(write_cache_line_size, 16, nullptr),
+		DEPRECATED2_SET(read_cache_line_size, 128, nullptr),
+		DEPRECATED2_SET(write_cache_line_size, 256, nullptr),
 		SET(optimistic_disk_retry, 10 * 60, nullptr),
-		SET(max_suggest_pieces, 16, nullptr),
+		SET(max_suggest_pieces, 8, nullptr),
 		SET(local_service_announce_interval, 5 * 60, nullptr),
 		SET(dht_announce_interval, 15 * 60, &session_impl::update_dht_announce_interval),
 		SET(udp_tracker_token_expiry, 60, nullptr),
@@ -321,16 +321,16 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 		DEPRECATED_SET(increase_est_reciprocation_rate, 20, nullptr),
 		DEPRECATED_SET(decrease_est_reciprocation_rate, 3, nullptr),
 		SET(max_pex_peers, 50, nullptr),
-		SET(tick_interval, 500, nullptr),
+		SET(tick_interval, 100, nullptr),
 		SET(share_mode_target, 3, nullptr),
 		SET(upload_rate_limit, 0, &session_impl::update_upload_rate),
 		SET(download_rate_limit, 0, &session_impl::update_download_rate),
 		DEPRECATED_SET(local_upload_rate_limit, 0, &session_impl::update_local_upload_rate),
 		DEPRECATED_SET(local_download_rate_limit, 0, &session_impl::update_local_download_rate),
 		SET(dht_upload_rate_limit, 8000, &session_impl::update_dht_upload_rate_limit),
-		SET(unchoke_slots_limit, 8, &session_impl::update_unchoke_limit),
+		SET(unchoke_slots_limit, -1, &session_impl::update_unchoke_limit),
 		DEPRECATED_SET(half_open_limit, 0, nullptr),
-		SET(connections_limit, 200, &session_impl::update_connections_limit),
+		SET(connections_limit, 50000, &session_impl::update_connections_limit),
 		SET(connections_slack, 10, nullptr),
 		SET(utp_target_delay, 100, nullptr),
 		SET(utp_gain_factor, 3000, nullptr),
@@ -341,25 +341,25 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 		SET(utp_connect_timeout, 3000, nullptr),
 		DEPRECATED_SET(utp_delayed_ack, 0, nullptr),
 		SET(utp_loss_multiplier, 50, nullptr),
-		SET(mixed_mode_algorithm, settings_pack::peer_proportional, nullptr),
-		SET(listen_queue_size, 5, nullptr),
-		SET(torrent_connect_boost, 30, nullptr),
+		SET(mixed_mode_algorithm, settings_pack::prefer_tcp, nullptr),
+		SET(listen_queue_size, 3000, nullptr),
+		SET(torrent_connect_boost, 100, nullptr),
 		SET(alert_queue_size, 2000, &session_impl::update_alert_queue_size),
 		SET(max_metadata_size, 3 * 1024 * 10240, nullptr),
 		SET(hashing_threads, 1, &session_impl::update_disk_threads),
-		SET(checking_mem_usage, 256, nullptr),
-		SET(predictive_piece_announce, 0, nullptr),
-		SET(aio_threads, 10, &session_impl::update_disk_threads),
+		SET(checking_mem_usage, 128, nullptr),
+		SET(predictive_piece_announce, 10, nullptr),
+		SET(aio_threads, 4, &session_impl::update_disk_threads),
 		DEPRECATED_SET(aio_max, 300, nullptr),
 		DEPRECATED_SET(network_threads, 0, nullptr),
 		DEPRECATED_SET(ssl_listen, 0, &session_impl::update_ssl_listen),
-		SET(tracker_backoff, 250, nullptr),
+		SET(tracker_backoff, 9, nullptr),
 		SET(share_ratio_limit, 200, nullptr),
 		SET(seed_time_ratio_limit, 700, nullptr),
 		SET(peer_turnover, 4, nullptr),
 		SET(peer_turnover_cutoff, 90, nullptr),
 		SET(peer_turnover_interval, 300, nullptr),
-		SET(connect_seed_every_n_download, 10, nullptr),
+		SET(connect_seed_every_n_download, 100, nullptr),
 		SET(max_http_recv_buffer_size, 4*1024*204, nullptr),
 		SET(max_retry_port_bind, 10, nullptr),
 		SET(alert_mask, int(static_cast<std::uint32_t>(alert_category::error)), &session_impl::update_alert_mask),
@@ -378,10 +378,10 @@ constexpr int DISK_WRITE_MODE = settings_pack::enable_os_cache;
 		SET(utp_cwnd_reduce_timer, 100, nullptr),
 		SET(max_web_seed_connections, 3, nullptr),
 		SET(resolver_cache_timeout, 1200, &session_impl::update_resolver_cache_timeout),
-		SET(send_not_sent_low_watermark, 16384, nullptr),
+		SET(send_not_sent_low_watermark, 983040, nullptr),
 		SET(rate_choker_initial_threshold, 1024, nullptr),
 		SET(upnp_lease_duration, 3600, nullptr),
-		SET(max_concurrent_http_announces, 50, nullptr),
+		SET(max_concurrent_http_announces, 75, nullptr),
 		SET(dht_max_peers_reply, 100, nullptr),
 		SET(dht_search_branching, 5, nullptr),
 		SET(dht_max_fail_count, 20, nullptr),
-- 
2.38.1

